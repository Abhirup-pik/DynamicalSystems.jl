


<a id='Spatio-Temporal-Prediction-Examples-1'></a>

# Spatio-Temporal Prediction Examples


In this page we are simply running files from the `examples` folder of the `TimeseriesPrediction` package.


This is how you can (programmatically) find this folder:


```julia
using TimeseriesPrediction
exdir = dirname(dirname(pathof(TimeseriesPrediction)))*"/examples"
```

```
"/home/travis/.julia/packages/TimeseriesPrediction/mWV1P/examples"
```


<a id='Temporal-Prediction:-Kuramoto-Sivashinsky-1'></a>

## Temporal Prediction: Kuramoto-Sivashinsky


*(this requires `FFTW` to be installed)*


This example predicts the temporal evolution of a one-dimensional field U, along with a time vector T, which has to be represented as vectors of vectors. Where the field comes from does not matter, but to make the example runnable we load one of the test systems of `TimeseriesPrediction`.


In this example we use the solution of Kuramoto Sivashinsky equation.


Importantly, the results are compared with the "real" evolution of the system.


In the plots, the x axis is space and y axis is time.


<a id='Produce-field-U-(Kuramoto-Sivashinsky)-1'></a>

### Produce field U (Kuramoto Sivashinsky)


```julia
using PyPlot
using TimeseriesPrediction

testdir = dirname(dirname(pathof(TimeseriesPrediction)))*"/test"
@assert isdir(testdir)
include(testdir*"/ks_solver.jl")

Ntrain = 10000
p = 100
N = Ntrain + p

U, T = KuramotoSivashinsky(64, 22, N÷4, 0.25)
```

```
(Array{Float64,1}[[1.0478, 1.09273, 1.13432, 1.17213, 1.20573, 1.23473, 1.25874, 1.27743, 1.29049, 1.29766  …  -1.29049, -1.27743, -1.25874, -1.23473, -1.20573, -1.17213, -1.13432, -1.09273, -1.0478, -1.0], [-0.154591, -0.120083, -0.0670139, 0.0316104, 0.200296, 0.459426, 0.823392, 1.29798, 1.87665, 2.53593  …  -3.6252, -3.01763, -2.40552, -1.83673, -1.34265, -0.939823, -0.632696, -0.416189, -0.277634, -0.19826], [-0.159322, -0.143299, -0.108362, -0.0288716, 0.118376, 0.352712, 0.688121, 1.13123, 1.6783, 2.31116  …  -3.32362, -2.72479, -2.14294, -1.61534, -1.16538, -0.804586, -0.534901, -0.350523, -0.239128, -0.182838], [-0.166804, -0.168216, -0.150385, -0.0890342, 0.0377116, 0.248066, 0.555451, 0.967023, 1.48134, 2.08497  …  -3.00973, -2.43007, -1.88476, -1.40133, -0.99632, -0.677204, -0.444089, -0.290798, -0.205494, -0.171223], [-0.177033, -0.19481, -0.193035, -0.148803, -0.041576, 0.145707, 0.425781, 0.806053, 1.28692, 1.85904  …  -2.68941, -2.13778, -1.63373, -1.19628, -0.836277, -0.558058, -0.360431, -0.237099, -0.176776, -0.163436], [-0.18997, -0.223051, -0.236286, -0.208146, -0.119422, 0.0457808, 0.299422, 0.64893, 1.0961, 1.63502  …  -2.36851, -1.85181, -1.39213, -1.00131, -0.685701, -0.447258, -0.283901, -0.189359, -0.152911, -0.159425], [-0.205542, -0.252916, -0.280152, -0.267091, -0.195839, -0.05166, 0.176579, 0.49614, 0.90982, 1.41451  …  -2.05243, -1.57538, -1.16156, -0.817027, -0.544649, -0.344625, -0.214256, -0.147352, -0.133717, -0.159063], [-0.223659, -0.284408, -0.324706, -0.325751, -0.270939, -0.146674, 0.0573283, 0.348022, 0.72887, 1.19899  …  -1.74566, -1.31086, -0.94295, -0.643515, -0.412803, -0.249701, -0.151035, -0.110679, -0.11889, -0.162153], [-0.244224, -0.317566, -0.370094, -0.384337, -0.34495, -0.239446, -0.0583959, 0.204753, 0.553854, 0.989721  …  -1.45159, -1.0597, -0.736558, -0.480393, -0.289507, -0.161767, -0.0935705, -0.0787838, -0.108017, -0.16844], [-0.267147, -0.352487, -0.416551, -0.443168, -0.418219, -0.330293, -0.170801, 0.0663479, 0.385184, 0.78776  …  -1.17243, -0.822538, -0.54209, -0.326908, -0.173838, -0.0798923, -0.0410176, -0.0509708, -0.100592, -0.177628]  …  [-1.88973, -1.39287, -0.974452, -0.630103, -0.338265, -0.0664519, 0.222856, 0.566571, 0.994947, 1.5246  …  0.229993, -1.06938, -2.2565, -3.18783, -3.77453, -3.99425, -3.88509, -3.5267, -3.01618, -2.4462], [-1.90904, -1.40939, -0.989124, -0.643583, -0.351046, -0.0790201, 0.209917, 0.55257, 0.979217, 1.50677  …  0.182741, -1.12511, -2.31699, -3.24878, -3.83204, -4.04549, -3.92864, -3.56246, -3.04504, -2.46954], [-1.92126, -1.41942, -0.998155, -0.652453, -0.360384, -0.0894279, 0.197745, 0.537848, 0.961226, 1.48519  …  0.123317, -1.19218, -2.38661, -3.31574, -3.89201, -4.09582, -3.96848, -3.59252, -3.06704, -2.48563], [-1.92612, -1.42283, -1.00156, -0.656821, -0.36644, -0.097858, 0.186166, 0.522259, 0.940865, 1.45976  …  0.0509755, -1.27099, -2.4654, -3.38833, -3.95379, -4.1444, -4.00373, -3.61607, -3.08154, -2.494], [-1.92342, -1.41957, -0.999397, -0.656828, -0.369397, -0.1045, 0.175007, 0.505666, 0.918039, 1.43044  …  -0.0349477, -1.36183, -2.55323, -3.46607, -4.01663, -4.19036, -4.03352, -3.63235, -3.08794, -2.49425], [-1.913, -1.40966, -0.991782, -0.652646, -0.369453, -0.109548, 0.164103, 0.487946, 0.892671, 1.39717  …  -0.135015, -1.46486, -2.64981, -3.54832, -4.07966, -4.23277, -4.05699, -3.64064, -3.08572, -2.48605], [-1.89481, -1.39316, -0.978869, -0.644475, -0.366816, -0.113193, 0.153299, 0.468992, 0.864702, 1.35993  …  -0.249676, -1.58007, -2.75471, -3.63432, -4.14194, -4.27065, -4.07326, -3.64026, -3.07443, -2.46918], [-1.86886, -1.3702, -0.960852, -0.632534, -0.361703, -0.115625, 0.142451, 0.448717, 0.8341, 1.31872  …  -0.379246, -1.70728, -2.86731, -3.72315, -4.20243, -4.303, -4.08149, -3.63061, -3.05369, -2.44346], [-1.83523, -1.34095, -0.937959, -0.617063, -0.354332, -0.117022, 0.131433, 0.427052, 0.800853, 1.27357  …  -0.523894, -1.84615, -2.98684, -3.81377, -4.26001, -4.3288, -4.08087, -3.61112, -3.02321, -2.40884], [-1.79409, -1.30566, -0.910449, -0.598311, -0.344923, -0.117556, 0.120133, 0.403952, 0.764976, 1.22455  …  -0.683619, -1.99611, -3.11232, -3.90496, -4.31346, -4.347, -4.07063, -3.58132, -2.98278, -2.36531]], [0.0, 250.25, 250.5, 250.75, 251.0, 251.25, 251.5, 251.75, 252.0, 252.25  …  2772.75, 2773.0, 2773.25, 2773.5, 2773.75, 2774.0, 2774.25, 2774.5, 2774.75, 2775.0])
```


<a id='Temporal-prediction-of-field-U-1'></a>

### Temporal prediction of field U


```julia
Q = length(U[1]) # spatial length
pool = U[1:Ntrain]
test = U[Ntrain:N]

D = 10
τ = 1
B = 10
k = 1
ntype = FixedMassNeighborhood(4)
method = AverageLocalModel()

em = cubic_shell_embedding(pool, D,τ,B,k,PeriodicBoundary())
pcaem= PCAEmbedding(pool,em)

@time pred = temporalprediction(pool,pcaem, p;ntype=ntype, method=method, progress = false)

err = [abs.(test[i]-pred[i]) for i=1:p+1]
println("Maximum error: ", maximum(maximum(e) for e in err))
```

```
  3.434362 seconds (2.76 M allocations: 258.422 MiB, 7.58% gc time)
Maximum error: 1.560061829488409
```


<a id='Plot-the-result-1'></a>

### Plot the result


Deduce field extremal values


```julia
vmax = max(maximum(maximum(s) for s in test),
           maximum(maximum(s) for s in pred))
vmin = min(minimum(minimum(s) for s in test),
           minimum(minimum(s) for s in pred))
```


Transform data for imshow


```julia
ptest = cat(test..., dims = 2)
ppred = cat(pred..., dims = 2)
perr = cat(err..., dims = 2)
```

```
64×101 Array{Float64,2}:
 0.0  0.0466572   0.117697   0.131286   …  0.0827052   0.0727434  0.0623404
 0.0  0.0436173   0.115838   0.130762      0.0706123   0.0620372  0.0532052
 0.0  0.0413012   0.115205   0.131936      0.0587733   0.0518077  0.0447218
 0.0  0.0391376   0.117112   0.134954      0.0486609   0.0433288  0.0379741
 0.0  0.0334451   0.117476   0.135102      0.0412595   0.0374743  0.0337473
 0.0  0.0205238   0.109696   0.126199   …  0.0371476   0.034779   0.0325509
 0.0  0.00147706  0.0859749  0.101104      0.0366562   0.0356417  0.0348383
 0.0  0.0192589   0.0393596  0.0534729     0.0399156   0.0403386  0.0409487
 0.0  0.0403113   0.031525   0.018191      0.0463207   0.0481664  0.050087
 0.0  0.0611593   0.119014   0.104414      0.0540394   0.0572844  0.0605297
 ⋮                                      ⋱                         ⋮
 0.0  0.0766729   0.360738   0.383049   …  0.0314821   0.0102704  0.011542
 0.0  0.0192884   0.329772   0.335125      0.00638236  0.0103296  0.0270158
 0.0  0.0237442   0.250627   0.256649      0.0235507   0.0342077  0.0442732
 0.0  0.0384169   0.167431   0.165226      0.0527045   0.0568562  0.0599991
 0.0  0.0403484   0.0786102  0.0711867     0.0765979   0.074821   0.0718174
 0.0  0.0394374   0.0014325  0.011789   …  0.0926161   0.0862161  0.0785707
 0.0  0.0401778   0.0614901  0.0733009     0.100036    0.0906531  0.0801566
 0.0  0.0437012   0.0980854  0.110615      0.0996262   0.0888658  0.0772044
 0.0  0.0472589   0.114488   0.127432      0.0931179   0.0822978  0.0708126
```


plot plot plot


```julia
fig = figure(figsize=(8,8))
ax1 = subplot2grid((3,1), (0,0))
ax2 = subplot2grid((3,1), (1,0))
ax3 = subplot2grid((3,1), (2,0));

im1 = ax1[:imshow](ppred, cmap="viridis", vmin = vmin, vmax = vmax,
aspect = "auto", extent = (T[Ntrain], T[N], 1, Q))
im2 = ax2[:imshow](ptest, cmap="viridis", vmin = vmin, vmax = vmax,
aspect = "auto", extent = (T[Ntrain], T[N], 1, Q))
im3 = ax3[:imshow](perr, cmap="inferno", vmin = 0, vmax = vmax-vmin,
aspect = "auto", extent = (T[Ntrain], T[N], 1, Q))

for (j, (im, ax)) in enumerate(zip([im1,im2,im3], [ax1,ax2,ax3]))
    colorbar(im, ax = ax, fraction=0.04, pad=0.01)# format="%.1f")
    if j < 3
        ax[:set_xticklabels]([])
    end
end
ax1[:set_title]("Prediction")
ax2[:set_title]("Real evolution")
ax3[:set_title]("Absolute error")

ax2[:set_ylabel]("space")
ax3[:set_xlabel]("time")
tight_layout(w_pad=0.1, h_pad=0.00001)
```


<a id='Cross-Prediction:-Barkley-Model-1'></a>

## Cross Prediction: Barkley Model


This example cross-predicts a field U from a field V. Both fields have to be represented as vectors of matrices. Where the fields come from does not matter, but to make the example runnable we load one of the test systems of TimeseriesPrediction.


This example uses cubic shell embedding and a linear Barkley model.


Importantly, the results are compared with the "real" evolution of the system.


<a id='Simulate-a-test-system-1'></a>

### Simulate a test system


```julia
using PyPlot
using TimeseriesPrediction

testdir = dirname(dirname(pathof(TimeseriesPrediction)))*"/test"
@assert isdir(testdir)
include(testdir*"/system_defs.jl")

Nx = 50
Ny = 50
Tskip = 100
Ttrain = 500
Ttest = 10
T = Tskip +Ttrain + Ttest

U, V = barkley_const_boundary(T, Nx, Ny)
```

```
(Array{Float64,2}[[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]  …  [0.0 0.000873772 … 0.714283 0.350567; 0.0 0.00164146 … 0.88903 0.700424; … ; 0.788544 0.926942 … 0.00137707 0.0; 0.673398 0.778726 … 0.000788564 0.0], [0.0 0.00168584 … 0.740534 0.560616; 0.0 0.00474622 … 0.918144 0.756898; … ; 0.777942 0.91608 … 0.00472607 0.0; 0.660117 0.763203 … 0.00120598 0.0], [0.0 0.005288 … 0.767252 0.670158; 0.000843772 0.00675866 … 0.920012 0.786251; … ; 0.760441 0.892693 … 0.00704562 0.00084019; 0.639123 0.734299 … 0.00421763 0.0], [0.000940088 0.00752624 … 0.769477 0.67346; 0.00120154 0.01402 … 0.924154 0.791156; … ; 0.732501 0.840673 … 0.0150582 0.00125255; 0.607686 0.679078 … 0.00641432 0.000749801], [0.001338 0.0143123 … 0.749256 0.661746; 0.00341343 0.0260811 … 0.910891 0.782796; … ; 0.681712 0.716886 … 0.0292437 0.00423909; 0.556046 0.561439 … 0.0129364 0.00114032], [0.00422895 0.0266882 … 0.710949 0.641083; 0.0056725 0.0500328 … 0.885694 0.766731; … ; 0.565 0.426478 … 0.0584682 0.00662048; 0.455228 0.317338 … 0.0253222 0.00397386], [0.00622397 0.0506239 … 0.637111 0.60937; 0.0115354 0.0932423 … 0.831789 0.742276; … ; 0.26268 0.0945737 … 0.112686 0.0139472; 0.226541 0.0908758 … 0.0504682 0.00612686], [0.0118203 0.0927365 … 0.496524 0.556536; 0.0216289 0.173475 … 0.715659 0.699393; … ; -0.0161034 0.0379771 … 0.215599 0.0271864; 0.00691966 0.0265669 … 0.0966845 0.0122211], [0.0220839 0.168929 … 0.25789 0.454678; 0.041341 0.308159 … 0.459732 0.61053; … ; 0.025917 -0.0136177 … 0.385739 0.0538793; -0.00106921 -0.00253738 … 0.18324 0.0238785], [0.0415628 0.29286 … 0.0973502 0.230729; 0.0780239 0.511106 … 0.128855 0.372636; … ; 0.00128021 0.012029 … 0.62023 0.105002; 0.000309238 8.91013e-5 … 0.326157 0.0468975]], Array{Float64,2}[[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]  …  [0.0263375 0.0294983 … 0.17603 0.0415426; 0.0365583 0.0410819 … 0.278159 0.0995797; … ; 0.29909 0.464618 … 0.0398081 0.0348826; 0.18684 0.329682 … 0.0290667 0.0255006], [0.0237038 0.0265485 … 0.229855 0.072445; 0.0329025 0.0371379 … 0.339246 0.159664; … ; 0.348035 0.51085 … 0.035965 0.0313943; 0.235495 0.374586 … 0.0261601 0.0229505], [0.0213334 0.0240622 … 0.280923 0.121262; 0.0296122 0.0338987 … 0.397136 0.219388; … ; 0.391026 0.551373 … 0.0328411 0.0282549; 0.277958 0.413448 … 0.0236647 0.0206555], [0.0192001 0.0221848 … 0.329556 0.176152; 0.026651 0.0311847 … 0.449424 0.276074; … ; 0.427968 0.585505 … 0.0302616 0.0254294; 0.314074 0.445533 … 0.02172 0.0185899], [0.0172801 0.0207189 … 0.373548 0.225883; 0.0241061 0.0294682 … 0.496897 0.327582; … ; 0.458421 0.611022 … 0.0287412 0.0230117; 0.343435 0.468887 … 0.0201894 0.0167309], [0.0156858 0.0200783 … 0.411119 0.269469; 0.0220368 0.0291295 … 0.538296 0.373104; … ; 0.48075 0.621608 … 0.0287915 0.0211344; 0.364696 0.478143 … 0.0194641 0.0151719], [0.0145402 0.0207393 … 0.441102 0.30663; 0.0204004 0.0312198 … 0.573036 0.412466; … ; 0.489175 0.602095 … 0.0317591 0.0196831; 0.37375 0.462062 … 0.0200499 0.0140521], [0.0137085 0.0237277 … 0.460703 0.336904; 0.0195139 0.0374221 … 0.598911 0.445447; … ; 0.466525 0.551343 … 0.0398519 0.0191095; 0.359029 0.424943 … 0.0230917 0.0132595], [0.0135197 0.0306286 … 0.464285 0.358867; 0.0197254 0.0510274 … 0.610586 0.470842; … ; 0.419873 0.500006 … 0.0574266 0.0199172; 0.323818 0.385106 … 0.030451 0.0131557], [0.0143761 0.0444586 … 0.443645 0.368449; 0.0218869 0.0767405 … 0.595501 0.484811; … ; 0.380477 0.450006 … 0.0902578 0.0233134; 0.291436 0.346595 … 0.04573 0.014228]])
```


<a id='Cross-predict-field-U-from-field-V-1'></a>

### Cross predict field U from field V


```julia
D = 2
τ = 1
B = 2
k = 1
bc = ConstantBoundary(20.0)

source_train = V[Tskip + 1:Tskip + Ttrain]
target_train = U[Tskip + 1:Tskip + Ttrain]
source_pred  = V[Tskip + Ttrain  - D*τ + 1:  T]
target_test  = U[Tskip + Ttrain  - D*τ + 1:  T]

em = cubic_shell_embedding(source_train, D,τ,B,k,bc)
pcaem = PCAEmbedding(source_train, em) # PCA speeds things up!

@time target_pred = crossprediction(source_train, target_train, source_pred, em;
progress = false)

err = [abs.(target_test[i]-target_pred[i]) for i=1:Ttest]

println("Maximum error: ", maximum(maximum(e) for e in err))
```

```
 39.813503 seconds (2.90 M allocations: 1.654 GiB, 1.68% gc time)
Maximum error: 0.6634129758284085
```


<a id='Plot-prediction-1'></a>

### Plot prediction


Deduce field extremal values


```julia
source_max = maximum(maximum(s) for s in source_pred)
target_max = max(maximum(maximum(s) for s in target_test),
                 maximum(maximum(s) for s in target_pred))
source_min = minimum(minimum(s) for s in source_pred)
target_min = min(minimum(minimum(s) for s in target_test),
                 minimum(minimum(s) for s in target_pred))
```


Plot various predicted frames (only the last one shown here)


```julia
for i in [1, length(err)÷2, length(err)]

    fig = figure(figsize=(10,10))
    ax1 = subplot2grid((2,2), (0,0))
    ax2 = subplot2grid((2,2), (0,1))
    ax3 = subplot2grid((2,2), (1,0))
    ax4 = subplot2grid((2,2), (1,1))
    im1 = ax1[:imshow](source_pred[i], cmap="viridis", vmin = source_min, vmax = source_max)
    im2 = ax2[:imshow](target_test[i], cmap="cividis", vmin = target_min, vmax = target_max)
    im3 = ax3[:imshow](target_pred[i], cmap="cividis", vmin = target_min, vmax = target_max)
    im4 = ax4[:imshow](err[i], cmap="inferno", vmin = 0, vmax = target_max - target_min)
    for (im, ax) in zip([im1,im2,im3,im4], [ax1,ax2,ax3,ax4])
        ax[:get_xaxis]()[:set_ticks]([])
        ax[:get_yaxis]()[:set_ticks]([])
        colorbar(im, ax = ax, fraction=0.046, pad=0.04)#, format="%.1f")
```


ax[:minorticks_off]()


```julia
    end
    ax1[:set_title]("Source")
    ax2[:set_title]("Target Test")
    ax3[:set_title]("Target Cross-Pred.")
    ax4[:set_title]("absolute error")
    tight_layout(w_pad=0.6, h_pad=0.00001)
    suptitle("frame $i")
end
```


<a id='Temporal-Prediction:-Periodic-Nonlinear-Barkley-Model-1'></a>

## Temporal Prediction: Periodic Nonlinear Barkley Model


This example predicts the temporal evolution of a field U, which has to be represented as vectors of matrices. Where the field comes from does not matter, but to make the example runnable we load one of the test systems of TimeseriesPrediction.


This example uses light cone embedding and a nonlinear Barkley model.


Importantly, the results are compared with the "real" evolution of the system.


<a id='Simulate-a-test-system-2'></a>

### Simulate a test system


```julia
using PyPlot
using TimeseriesPrediction

testdir = dirname(dirname(pathof(TimeseriesPrediction)))*"/test"
@assert isdir(testdir)
include(testdir*"/system_defs.jl")

Nx = 50
Ny = 50
Tskip = 100
Ttrain = 600
Ttest = 10
T = Tskip + Ttrain + Ttest

U, V = barkley_periodic_boundary_nonlin(T, Nx, Ny)
```

```
(Array{Float64,2}[[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]  …  [0.88994 0.312029 … 1.00078 0.983125; 0.795181 0.206796 … 0.990988 0.980456; … ; 0.9832 0.812883 … 1.00133 0.989008; 0.944765 0.585108 … 0.990169 1.00012], [0.790946 0.214333 … 0.987614 0.97932; 0.640834 0.157922 … 0.994742 0.953452; … ; 0.954701 0.663753 … 0.986359 1.00187; 0.900951 0.351134 … 0.996088 0.983453], [0.628458 0.161394 … 0.986069 0.950116; 0.412539 0.122413 … 0.980542 0.914455; … ; 0.920982 0.434888 … 0.98916 0.983743; 0.805813 0.228906 … 0.980366 0.980042], [0.392379 0.121058 … 0.964918 0.904238; 0.23412 0.0763324 … 0.964689 0.82738; … ; 0.838122 0.257764 … 0.967152 0.982756; 0.645809 0.176436 … 0.969494 0.950233], [0.227427 0.0738527 … 0.927603 0.800586; 0.17388 0.0474205 … 0.920779 0.668837; … ; 0.69206 0.20204 … 0.942344 0.953273; 0.407274 0.124344 … 0.932589 0.900393], [0.171382 0.0468717 … 0.835587 0.609894; 0.124187 0.0349984 … 0.816803 0.42412; … ; 0.459432 0.139231 … 0.878211 0.903297; 0.233293 0.0796607 … 0.855506 0.784555], [0.112958 0.0353753 … 0.623571 0.336144; 0.0802267 0.0245019 … 0.576045 0.209486; … ; 0.253846 0.0905302 … 0.745208 0.781018; 0.175974 0.0479784 … 0.683001 0.562652], [0.0658862 0.0220313 … 0.253882 0.15059; 0.0388738 0.0168394 … 0.19403 0.120046; … ; 0.187376 0.0539909 … 0.492401 0.530045; 0.104379 0.0379461 … 0.362605 0.26176], [0.0291167 0.0150243 … 0.0400831 0.0581777; 0.0263708 0.00851726 … 0.0331976 0.0334407; … ; 0.102573 0.0415108 … 0.17828 0.200482; 0.0550859 0.0199479 … 0.0751111 0.0988281], [0.0155209 0.0063028 … 0.0175068 0.00867733; 0.00564115 0.00722687 … 0.00785014 0.0115117; … ; 0.0455609 0.0200195 … 0.0444135 0.0719093; 0.02135 0.014202 … 0.030996 0.022998]], Array{Float64,2}[[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]  …  [0.656273 0.570226 … 0.585702 0.607196; 0.656837 0.511348 … 0.594557 0.625371; … ; 0.601269 0.652383 … 0.550789 0.542238; 0.638726 0.626848 … 0.573671 0.577336], [0.661129 0.516242 … 0.627367 0.641499; 0.641433 0.461098 … 0.632422 0.657085; … ; 0.636187 0.640858 … 0.596109 0.584753; 0.659182 0.584194 … 0.613384 0.619639], [0.644497 0.465602 … 0.66096 0.671272; 0.603607 0.415382 … 0.667611 0.678052; … ; 0.659584 0.606015 … 0.632462 0.626839; 0.666395 0.530104 … 0.650876 0.652792], [0.604869 0.419462 … 0.690743 0.689914; 0.550267 0.374027 … 0.695125 0.686716; … ; 0.671745 0.553639 … 0.665999 0.659357; 0.65208 0.478293 … 0.680014 0.681645], [0.550423 0.377694 … 0.711509 0.694857; 0.496524 0.336669 … 0.715389 0.674683; … ; 0.663444 0.499987 … 0.689864 0.688337; 0.613806 0.431013 … 0.703137 0.699281], [0.496557 0.339964 … 0.720173 0.676684; 0.447397 0.303013 … 0.721917 0.637135; … ; 0.630245 0.450813 … 0.704559 0.70613; 0.559181 0.388104 … 0.713932 0.702348], [0.447405 0.305978 … 0.706497 0.631702; 0.402849 0.272716 … 0.70422 0.58105; … ; 0.576918 0.406002 … 0.701836 0.709221; 0.504533 0.349344 … 0.705153 0.680405], [0.402808 0.275385 … 0.660094 0.57233; 0.362616 0.245446 … 0.652912 0.523865; … ; 0.520862 0.365476 … 0.673036 0.68594; 0.454624 0.314421 … 0.666499 0.630177], [0.362556 0.247848 … 0.595721 0.515438; 0.32636 0.220901 … 0.588352 0.471651; … ; 0.469434 0.328944 … 0.617671 0.632237; 0.409276 0.282984 … 0.604617 0.568952], [0.326303 0.223063 … 0.536156 0.463914; 0.293726 0.198811 … 0.52952 0.42449; … ; 0.422599 0.296057 … 0.556471 0.56982; 0.368365 0.254687 … 0.544197 0.512154]])
```


<a id='Temporal-prediction-of-field-U-2'></a>

### Temporal prediction of field U


```julia
D = 2
τ = 1
r₀ = 1
c = 1
bc = PeriodicBoundary()

pool = U[Tskip + 1 : Tskip + Ttrain]
test  = U[Tskip + Ttrain : T]

em = light_cone_embedding(pool, D,τ,r₀,c,bc)
pcaem = PCAEmbedding(pool, em) # PCA speeds things up!

@time pred = temporalprediction(pool, em, Ttest; progress = false)

err = [abs.(test[i]-pred[i]) for i=1:Ttest+1]

println("Maximum error: ", maximum(maximum(e) for e in err))
```

```
 53.785581 seconds (1.88 M allocations: 1.748 GiB, 1.30% gc time)
Maximum error: 0.15598909707252984
```


<a id='Plot-prediction-2'></a>

### Plot prediction


Deduce field maximum values


```julia
vmax = max(maximum(maximum(s) for s in test),
           maximum(maximum(s) for s in pred))
vmin = min(minimum(minimum(s) for s in test),
           minimum(minimum(s) for s in pred))
```


plot plot plot


```julia
for i in [1, length(err)÷2, length(err)]

    fig = figure(figsize=(10,3))
    ax1 = subplot2grid((1,3), (0,0))
    ax2 = subplot2grid((1,3), (0,1))
    ax3 = subplot2grid((1,3), (0,2))

    im1 = ax1[:imshow](pred[i], cmap="viridis", vmin = vmin, vmax = vmax)
    im2 = ax2[:imshow](test[i], cmap="viridis", vmin = vmin, vmax = vmax)
    im3 = ax3[:imshow](err[i], cmap="inferno", vmin = 0, vmax = vmax-vmin)
    for (im, ax) in zip([im1,im2,im3], [ax1,ax2,ax3])
        ax[:get_xaxis]()[:set_ticks]([])
        ax[:get_yaxis]()[:set_ticks]([])
        colorbar(im, ax = ax, fraction=0.046, pad=0.04)#, format="%.1f")
```


ax[:minorticks_off]()


```julia
    end
    ax1[:set_title]("Prediction")
    ax2[:set_title]("Real evolution")
    ax3[:set_title]("Absolute error")
    suptitle("frame $i")
    tight_layout(w_pad=0.6, h_pad=0.00001)
    subplots_adjust(top=0.75)
end
```


*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

